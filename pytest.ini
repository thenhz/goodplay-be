[tool:pytest]
# Pytest configuration for GoodPlay Backend Test Suite

# Test discovery
testpaths = tests
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Add current directory to Python path (Enhanced with performance monitoring)
addopts =
    --verbose
    --tb=short
    --strict-markers
    --disable-warnings
    --color=yes
    --durations=15
    --durations-min=0.5
    --cov=app
    --cov-report=html:htmlcov
    --cov-report=term-missing
    --cov-report=xml
    --cov-fail-under=80
    --maxfail=5
    --tb=line

# Test markers (Enhanced with new architecture)
markers =
    # Test Types
    unit: Unit tests with enhanced mocking
    integration: Integration tests with minimal mocking
    api: API endpoint tests

    # Test Layers
    model: Model/data layer tests
    repository: Repository layer tests
    service: Service layer tests
    controller: Controller layer tests

    # Feature Areas
    auth: Authentication and authorization tests
    preferences: User preferences tests
    social: Social features tests
    games: Game engine tests
    donations: Donation system tests
    onlus: ONLUS management tests
    admin: Admin functionality tests

    # Performance and Quality
    slow: Slow running tests (>1s)
    performance: Performance benchmark tests
    load: Load testing
    stress: Stress testing

    # Environment and Infrastructure
    external: Tests requiring external services
    database: Tests requiring database connection
    mock: Tests with extensive mocking

    # Development and CI/CD
    dev: Development-only tests
    pipeline: Tests that should run in CI/CD pipeline
    local: Tests that only run locally
    smoke: Quick smoke tests
    regression: Regression tests

    # Enterprise Features
    enterprise: Enterprise-grade architecture tests
    foundation: Test architecture foundation tests
    config: Configuration and setup tests

# Minimum Python version
minversion = 3.8

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning:bson.*
    ignore::UserWarning:pymongo.*

# Test environment (Enhanced with TestConfig integration)
env =
    TESTING = true
    FLASK_ENV = testing
    MONGO_URI = mongodb://localhost:27017/goodplay_test
    JWT_SECRET_KEY = test-jwt-secret-key-for-testing
    SECRET_KEY = test-secret-key-for-testing
    LOG_LEVEL = ERROR
    PERFORMANCE_MONITORING = true

# Performance and timeout settings
timeout = 300
slow_test_threshold = 1.0

# Parallel execution options
# addopts = --numprocesses=auto  # Uncomment for parallel testing with pytest-xdist
# Use with: pip install pytest-xdist

# Test collection optimization
collect_ignore = setup.py build dist .tox venv node_modules

# Console output settings
console_output_style = progress
junit_family = xunit2